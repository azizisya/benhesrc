#!/bin/bash
#
# Terrier - Terabyte Retriever
# Webpage: http://ir.dcs.gla.ac.uk/terrier 
# Contact: terrier@dcs.gla.ac.uk 
#
# The contents of this file are subject to the Mozilla Public
# License Version 1.1 (the "License"); you may not use this file
# except in compliance with the License. You may obtain a copy of
# the License at http://www.mozilla.org/MPL/
#
# Software distributed under the License is distributed on an "AS
# IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
# implied. See the License for the specific language governing
# rights and limitations under the License.
#
# The Original Code is configure.sh
#
# The Initial Developer of the Original Code is the University of Glasgow.
# Portions created by The Initial Developer are Copyright (C) 2004-2008
# the initial Developer. All Rights Reserved.
#
# Contributor(s):
#	Craig Macdonald <craigm@dcs.gla.ac.uk> (original author)
#
# Creates the configure file.

fullPath () {
	t='TEMP=`cd $TEMP; pwd`'
	for d in $*; do
		eval `echo $t | sed 's/TEMP/'$d'/g'`
	done
}

#setup TERRIER_HOME
if [ ! -n "$TERRIER_HOME" ]
then
	#find out where this script is running
	TEMPVAR=`dirname $0`
	#make the path abolute
	fullPath TEMPVAR
	#terrier folder is folder above
	TERRIER_HOME=`dirname $TEMPVAR`
	echo "Setting TERRIER_HOME to $TERRIER_HOME"
fi

if [ ! -n "$JAVA_HOME" ]
then
	#where is java?
	TEMPVAR=`which java`
	#j2sdk/bin folder is in the dir that java was in
	TEMPVAR=`dirname $TEMPVAR`
	#then java install prefix is folder above
	export JAVA_HOME=`dirname $TEMPVAR`
	echo "Setting JAVA_HOME to $JAVA_HOME"
fi

MANIFEST=share/MANIFEST.txt
DIST_DIRS="bin/ doc/javadoc/ lib/ etc/ src/ var/index/ share/"
if [ ! -n "$VERSION" ]
then
	VERSION=2.2.1
fi

CLASSPATH=''
for jar in $TERRIER_HOME/lib/*.jar; do
	if [ ! -n "$CLASSPATH" ]
	then
		CLASSPATH=$jar
	else
		CLASSPATH=$CLASSPATH:$jar
	fi
done

JAR_NAME=terrier-$VERSION
TAR_NAME=terrier-$VERSION
DIR_NAME=terrier
DIST=unix
TMPDIR=tmp_classes/
UNIX_COMPRESSION=gz
BZIP=`which bzip2`
TAR=`which tar`
GZIP=`which gzip`
ZIP=`which zip`


#cat $MANIFEST | egrep "\.java$" | xargs
JAVA_FILES=`cat $MANIFEST |egrep -v "^#" | egrep "\.java$" | xargs`
TEST_SCRIPTS=`egrep 'share/tests/tests\.[0-9]+\.sh$' $MANIFEST | xargs`

echo "#config automatically generated by bin/configure.sh" >>config
echo JAVA_HOME=$JAVA_HOME >>config
echo TAR_NAME=$TAR_NAME >>config
echo DIR_NAME=$DIR_NAME >>config
echo DIST=$DIST >>config
echo VERSION=$VERSION >>config
echo DIST_DIRS=$DIST_DIRS >>config
echo MANIFEST=$MANIFEST >>config
echo CLASSPATH=$CLASSPATH >>config
echo JAVA_FILES="$JAVA_FILES" >>config
echo TEST_SCRIPTS="$TEST_SCRIPTS" >> config
echo TMPDIR=$TMPDIR >>config
echo JAR_NAME=$JAR_NAME >>config
echo UNIX_COMPRESSION=$UNIX_COMPRESSION >>config
echo BZIP=$BZIP >>config
echo TAR=$TAR >>config
echo GZIP=$GZIP >>config
echo ZIP=$ZIP >>config
